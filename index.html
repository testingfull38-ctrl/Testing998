<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pinky Solana Faucet (Devnet)</title>

  <!-- Buffer polyfill -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
  <script>
    if (typeof window.Buffer === "undefined") {
      window.Buffer = buffer.Buffer;
    }
  </script>

  <!-- Solana web3.js -->
  <script src="https://unpkg.com/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .blink { animation: blinker 1.5s linear infinite; }
    @keyframes blinker { 50% { opacity: 0.3; } }
    .gradient-bg {
      background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div class="container mx-auto px-4 py-12 max-w-3xl">
    <!-- Header -->
    <header class="flex items-center justify-center mb-12">
      <div class="w-12 h-12 mr-3 gradient-bg rounded-full flex items-center justify-center">
        <span class="font-bold text-xl">◎</span>
      </div>
      <h1 class="text-4xl font-bold">Pinky Solana Faucet</h1>
    </header>

    <!-- Main Card -->
    <div class="bg-gray-800 rounded-2xl shadow-xl p-8 mb-8">
      <h2 class="text-2xl font-bold mb-6 text-center">Claim 0.1 SOL on Devnet every 30 minutes</h2>
      <div id="stateContainer"></div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-gray-500 text-sm">
      <p>Connect with Phantom or Solflare wallet. Works only on <b>Solana Devnet</b>.</p>
      <p class="mt-2">© 2025 Pinky Solana Faucet</p>
    </footer>
  </div>

<script>
  // Config
  const REWARD_AMOUNT = 0.1; // SOL
  const COOLDOWN_MINUTES = 30;
  const RPC_URL = "https://api.devnet.solana.com"; // devnet RPC
  const connection = new solanaWeb3.Connection(RPC_URL);

  // State
  let walletConnected = false;
  let walletAddress = "";
  let lastClaimTime = parseInt(localStorage.getItem("last_claim_time") || "0");
  let countdownInterval = null;

  const stateContainer = document.getElementById("stateContainer");

  // Render UI
  function renderState() {
    if (!walletConnected) {
      stateContainer.innerHTML = `
        <div class="text-center">
          <p class="mb-6">Connect your wallet to start claiming free SOL!</p>
          <button id="connectBtn" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-full text-lg transition">
            Connect Wallet
          </button>
        </div>
      `;
      document.getElementById("connectBtn").addEventListener("click", connectWallet);
      return;
    }

    // Wallet connected
    const now = Date.now();
    const cooldownSeconds = COOLDOWN_MINUTES * 60;
    const secondsLeft = Math.max(0, cooldownSeconds - Math.floor((now - lastClaimTime) / 1000));

    stateContainer.innerHTML = `
      <div class="text-center">
        <p class="mb-2">Connected: <span class="font-mono text-blue-400">${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}</span></p>
        <p class="mb-6">You can request <b>${REWARD_AMOUNT} SOL</b> every 30 minutes.</p>
        
        <div class="mt-6 mb-6">
          <div class="text-3xl font-bold mb-2" id="countdown">
            ${secondsLeft > 0 ? formatTime(secondsLeft) : "READY TO CLAIM!"}
          </div>
          <p>cooldown</p>
        </div>

        <button id="claimBtn" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-full text-lg transition" ${secondsLeft>0?"disabled":""}>
          Claim SOL
        </button>
      </div>
    `;

    if (secondsLeft > 0) startCountdown(secondsLeft);
    document.getElementById("claimBtn").addEventListener("click", claimReward);
  }

  // Format time
  function formatTime(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
  }

  function startCountdown(secondsLeft) {
    if (countdownInterval) clearInterval(countdownInterval);
    countdownInterval = setInterval(() => {
      const now = Date.now();
      const cooldownSeconds = COOLDOWN_MINUTES * 60;
      const secondsLeft = Math.max(0, cooldownSeconds - Math.floor((now - lastClaimTime) / 1000));
      if (secondsLeft <= 0) {
        clearInterval(countdownInterval);
        document.getElementById("countdown").textContent = "READY TO CLAIM!";
        document.getElementById("countdown").classList.add("text-green-400", "blink");
        return;
      }
      document.getElementById("countdown").textContent = formatTime(secondsLeft);
    }, 1000);
  }

  // Wallet connect
  async function connectWallet() {
    if (window.solana && window.solana.isPhantom) {
      try {
        const resp = await window.solana.connect();
        walletAddress = resp.publicKey.toString();
        walletConnected = true;
        renderState();
      } catch (err) {
        alert("Wallet connection failed: " + err.message);
      }
    } else if (window.solflare && window.solflare.isSolflare) {
      try {
        await window.solflare.connect();
        walletAddress = window.solflare.publicKey.toString();
        walletConnected = true;
        renderState();
      } catch (err) {
        alert("Wallet connection failed: " + err.message);
      }
    } else {
      alert("Phantom or Solflare wallet not found!");
    }
  }

  // Claim reward (real Devnet airdrop)
  async function claimReward() {
    try {
      const now = Date.now();
      const cooldownSeconds = COOLDOWN_MINUTES * 60;
      const timeSinceLastClaim = Math.floor((now - lastClaimTime) / 1000);

      if (timeSinceLastClaim < cooldownSeconds) {
        alert(`Please wait ${formatTime(cooldownSeconds - timeSinceLastClaim)} before claiming again`);
        return;
      }

      const pubkey = new solanaWeb3.PublicKey(walletAddress);
      const sig = await connection.requestAirdrop(pubkey, REWARD_AMOUNT * solanaWeb3.LAMPORTS_PER_SOL);
      await connection.confirmTransaction(sig, "confirmed");

      lastClaimTime = Date.now();
      localStorage.setItem("last_claim_time", lastClaimTime.toString());

      alert("Success! 0.1 SOL (Devnet) has been airdropped to your wallet.");
      renderState();
    } catch (err) {
      alert("Claim failed: " + err.message);
    }
  }

  // Init
  window.addEventListener("DOMContentLoaded", renderState);
</script>
</body>
</html>
